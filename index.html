<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Astronomy Library Network</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #1e1e2f;
      color: #fff;
      font-family: 'Arial', sans-serif;
    }

    #connections-graph-container {
      position: relative;
      background-color: #1e1e2f;
      margin: 0 auto;
      width: 100%;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #connections-graph {
      height: 700px;
      width: 100%;
      border: 1px solid #333;
      border-radius: 8px;
      overflow: hidden;
      margin-top: -200px; /* Raises the graph by 100px */
    }

    .toggle-physics-button {
      background-color: #4a90e2;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      font-size: 18px;
      margin: 0 auto;
      cursor: pointer;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 10px;
      z-index: 9999;
      transition: background-color 0.3s ease;
    }

    .toggle-physics-button:hover {
      background-color: #357abd;
    }

    .toggle-physics-button:active {
      transform: translateY(1px);
    }

    .device-status {
      margin-top: 10px;
      font-size: 16px;
      color: #ff6f61;
      font-weight: bold;
    }

    .device-status.connected {
      color: #4caf50;
    }

    .device-status.not-connected {
      color: #f44336;
    }
  </style>
</head>
<body>

<div id="connections-graph-container">
  <button class="toggle-physics-button">Push Button</button>
  <div id="connections-graph"></div>
  <div class="device-status">Device not connected</div> <!-- Device Status Indicator -->
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const items = [
      { id: 1, title: "Isaac Newton", type: "Author", tags: ["Classical Mechanics", "Physics"] },
      { id: 2, title: "Galileo Galilei", type: "Author", tags: ["Astronomy", "Physics"] },
      { id: 3, title: "The Principia", type: "Book", tags: ["Isaac Newton", "Mathematics", "Physics"] },
      { id: 4, title: "Cosmos", type: "Book", tags: ["Carl Sagan", "Astronomy"] },
      { id: 5, title: "Stephen Hawking", type: "Author", tags: ["Cosmology", "Physics"] },
      { id: 6, title: "A Brief History of Time", type: "Book", tags: ["Stephen Hawking", "Cosmology"] },
      { id: 7, title: "Black Holes", type: "Subject", tags: ["Astronomy", "Physics"] },
      { id: 8, title: "Big Bang Theory", type: "Subject", tags: ["Astronomy", "Cosmology"] },
      { id: 9, title: "Neutron Stars", type: "Subject", tags: ["Astronomy", "Physics"] },
      { id: 10, title: "Stellar Evolution", type: "Subject", tags: ["Astronomy", "Physics"] },
      { id: 11, title: "Neil deGrasse Tyson", type: "Author", tags: ["Astronomy", "Astrophysics"] },
      { id: 12, title: "Astrophysics for People in a Hurry", type: "Book", tags: ["Neil deGrasse Tyson", "Astrophysics"] },
      { id: 13, title: "Astronomical Units", type: "Concept", tags: ["Astronomy"] },
      { id: 14, title: "The Milky Way", type: "Subject", tags: ["Astronomy", "Cosmology"] },
      { id: 15, title: "Hubble Space Telescope", type: "Item", tags: ["Astronomy", "Technology"] },
      { id: 16, title: "Albert Einstein", type: "Author", tags: ["Relativity", "Physics"] },
      { id: 17, title: "Relativity: The Special and General Theory", type: "Book", tags: ["Albert Einstein", "Relativity"] },
      { id: 18, title: "James Clerk Maxwell", type: "Author", tags: ["Electromagnetism", "Physics"] },
      { id: 19, title: "Maxwell's Equations", type: "Concept", tags: ["James Clerk Maxwell", "Electromagnetism", "Physics"] },
      { id: 20, title: "Quantum Mechanics", type: "Subject", tags: ["Physics", "Mathematics"] },
      { id: 21, title: "Marie Curie", type: "Author", tags: ["Radiation", "Physics"] },
      { id: 22, title: "Radioactive Elements", type: "Concept", tags: ["Marie Curie", "Radiation", "Chemistry"] },
      { id: 23, title: "Dark Matter", type: "Subject", tags: ["Astronomy", "Cosmology"] },
      { id: 24, title: "James Peebles", type: "Author", tags: ["Cosmology", "Physics"] },
      { id: 25, title: "The Early Universe", type: "Book", tags: ["James Peebles", "Cosmology"] },
      { id: 26, title: "Event Horizon", type: "Concept", tags: ["Astrophysics", "Black Holes"] },
      { id: 27, title: "Observational Cosmology", type: "Subject", tags: ["Cosmology", "Astronomy"] },
      { id: 28, title: "Space-Time Continuum", type: "Concept", tags: ["Relativity", "Physics"] },
      { id: 29, title: "Roger Penrose", type: "Author", tags: ["Mathematics", "Physics"] },
      { id: 30, title: "The Road to Reality", type: "Book", tags: ["Roger Penrose", "Mathematics", "Physics"] },
      { id: 31, title: "LIGO", type: "Item", tags: ["Astronomy", "Technology"] },
      { id: 32, title: "Gravitational Waves", type: "Subject", tags: ["Physics", "Astronomy"] },
      { id: 33, title: "Laws of Thermodynamics", type: "Concept", tags: ["Physics"] },
      { id: 34, title: "Cosmic Microwave Background", type: "Concept", tags: ["Cosmology", "Astronomy"] },
      { id: 35, title: "Dark Energy", type: "Subject", tags: ["Astronomy", "Cosmology"] },
      { id: 36, title: "William Herschel", type: "Author", tags: ["Astronomy", "Physics"] },
      { id: 37, title: "The Discovery of Uranus", type: "Book", tags: ["William Herschel", "Astronomy"] },
      { id: 38, title: "Exoplanets", type: "Subject", tags: ["Astronomy", "Physics"] },
      { id: 39, title: "The Solar System", type: "Concept", tags: ["Astronomy"] },
      { id: 40, title: "Antimatter", type: "Subject", tags: ["Physics", "Cosmology"] }
    ];

    const nodes = new vis.DataSet([]);
    const edges = new vis.DataSet([]);
    const nodeConnections = {};

    const groups = {
      Author: { color: { background: '#7f4b94', border: '#5a2d7b' } },
      Book: { color: { background: '#53a6c1', border: '#1f4e5b' } },
      Subject: { color: { background: '#c0c2ff', border: '#8f90ff' } },
      Concept: { color: { background: '#ffdf87', border: '#d4b142' } },
      Item: { color: { background: '#5d81ff', border: '#3e5a99' } }
    };

    items.forEach(item => {
      const itemNode = {
        id: item.id,
        label: item.title,
        title: `<h3>${item.title}</h3><ul>${item.tags.map(tag => `<li>${tag}</li>`).join('')}</ul>`,
        group: item.type,
        level: item.type === "Author" ? 0 : 1,
      };
      nodes.add(itemNode);

      if (item.type === "Author") {
        item.tags.forEach(tag => {
          const tagNode = { id: `tag-${tag}`, label: tag, group: "Concept", level: 2 };
          nodes.add(tagNode);
          edges.add({ from: item.id, to: `tag-${tag}` });
        });
      }
    });

    const container = document.getElementById('connections-graph');
    const options = {
      autoResize: true,
      layout: { hierarchical: { direction: 'LR', sortMethod: 'directed' } },
      physics: { enabled: false },
      groups: groups
    };

    const network = new vis.Network(container, { nodes, edges }, options);

    // Toggle physics state on button click
    const togglePhysicsButton = document.querySelector(".toggle-physics-button");
    togglePhysicsButton.addEventListener("click", () => {
      options.physics.enabled = !options.physics.enabled;
      network.setOptions(options);
      togglePhysicsButton.textContent = options.physics.enabled ? 'Turn Off Physics' : 'Turn On Physics';
    });

    // WebUSB Device status handling
    const deviceStatusElement = document.querySelector(".device-status");

    async function detectDevice() {
      if ('usb' in navigator) {
        console.log("WebUSB API is supported.");
        try {
          const devices = await navigator.usb.getDevices();
          console.log('Devices detected:', devices);

          if (devices.length === 0) {
            console.log("No devices found.");
            deviceStatusElement.classList.remove('connected');
            deviceStatusElement.classList.add('not-connected');
            deviceStatusElement.textContent = "Device not connected";
          } else {
            const device = devices[0];
            console.log("Device found:", device);
            await device.open();
            console.log('Device opened:', device);

            deviceStatusElement.classList.remove('not-connected');
            deviceStatusElement.classList.add('connected');
            deviceStatusElement.textContent = "Device connected: " + device.productName;
          }
        } catch (error) {
          console.error("Error accessing devices:", error);
          deviceStatusElement.classList.remove('connected');
          deviceStatusElement.classList.add('not-connected');
          deviceStatusElement.textContent = "Device not connected";
        }
      } else {
        console.log("WebUSB API is not supported in this browser.");
        deviceStatusElement.classList.remove('connected');
        deviceStatusElement.classList.add('not-connected');
        deviceStatusElement.textContent = "WebUSB API not supported";
      }
    }

    detectDevice(); // Detect device on page load
  });
</script>

</body>
</html>
