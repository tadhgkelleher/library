<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Medical Knowledge Graph</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/9.1.2/vis-network.min.css" rel="stylesheet">
  <script src="https://cdn.nextmind.com/nextmind.js"></script>
  <style>
    body {
      background-color: #10101a;
      color: #e0e0e0;
      font-family: 'Inter', 'Arial', sans-serif;
      margin: 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #graph-container {
      flex-grow: 1;
      position: relative;
    }

    #connections-graph {
      height: 100%;
      width: 100%;
    }
    
    #info-panel {
        position: absolute;
        top: 20px;
        right: -400px;
        width: 350px;
        background-color: rgba(20, 20, 30, 0.85);
        backdrop-filter: blur(10px);
        border-left: 1px solid #4a4a5a;
        border-radius: 8px 0 0 8px;
        padding: 20px;
        box-shadow: -5px 0 15px rgba(0,0,0,0.3);
        transition: right 0.4s ease-in-out;
        max-height: calc(100vh - 40px);
        overflow-y: auto;
    }

    #info-panel.visible {
        right: 0;
    }
    
    #info-panel h2 {
        margin-top: 0;
        color: #87ceeb;
    }

    #info-panel #close-panel {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        color: #fff;
        font-size: 24px;
        cursor: pointer;
    }
    
    #controls {
        position: absolute;
        top: 20px;
        left: 20px;
        background-color: rgba(20, 20, 30, 0.85);
        backdrop-filter: blur(10px);
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        z-index: 10;
    }

    .control-button {
      background-color: #4a90e2;
      color: white;
      padding: 10px 18px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      margin-top: 10px;
    }

    .control-button:hover {
      background-color: #357abd;
      transform: translateY(-2px);
    }
    
    #search-box {
        width: 100%;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #4a4a5a;
        background-color: #1e1e2f;
        color: #fff;
        margin-bottom: 10px;
    }

    #filter-container {
        margin-top: 15px;
    }
    
    #nextmind-status {
      position: absolute;
      bottom: 15px;
      left: 20px;
      color: #aaa;
      font-size: 14px;
    }

  </style>
</head>
<body>

<div id="controls">
    <input type="text" id="search-box" placeholder="Search nodes...">
    <div id="filter-container"></div>
    <button id="toggle-physics-button" class="control-button">Toggle Physics</button>
</div>

<div id="graph-container">
  <div id="connections-graph"></div>
</div>

<div id="info-panel">
    <button id="close-panel">&times;</button>
    <h2 id="info-title"></h2>
    <p id="info-type"></p>
    <p id="info-description"></p>
    <div id="info-tags"></div>
    <a id="info-link" href="#" target="_blank" rel="noopener noreferrer">Learn More</a>
</div>


<div id="nextmind-status">NextMind: Disconnected</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/9.1.2/vis-network.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const items = [
        // Expanded Data - More granularity
        // Diseases
        { id: 1, title: "Influenza", type: "Disease", tags: ["Virus", "Respiratory System", "Oseltamivir", "Vaccination"], description: "A viral infection that attacks your respiratory system." },
        { id: 2, title: "COVID-19", type: "Disease", tags: ["Virus", "Respiratory System", "Paxlovid", "Vaccination"], description: "An infectious disease caused by the SARS-CoV-2 virus." },
        { id: 16, title: "Hypertension", type: "Disease", tags: ["Cardiovascular System", "Lisinopril", "Diet", "Exercise"], description: "A condition in which the force of the blood against the artery walls is too high." },
        { id: 36, title: "Type 2 Diabetes", type: "Disease", tags: ["Endocrine System", "Metformin", "Diet", "Insulin Therapy"], description: "A chronic condition that affects the way the body processes blood sugar (glucose)." },
        { id: 41, title: "Rheumatoid Arthritis", type: "Disease", tags: ["Musculoskeletal System", "Immune System", "Methotrexate"], description: "A chronic inflammatory disorder affecting many joints, including those in the hands and feet." },
        { id: 45, title: "Lung Cancer", type: "Disease", tags: ["Respiratory System", "Smoking", "Chemotherapy", "Radiation Therapy", "Carcinogens"], description: "A type of cancer that begins in the lungs." },
        { id: 50, title: "Depression", type: "Disease", tags: ["Nervous System", "Psychotherapy", "Sertraline"], description: "A mood disorder causing a persistent feeling of sadness and loss of interest." },

        // Causes & Risk Factors
        { id: 101, title: "Virus", type: "Cause" },
        { id: 102, title: "Bacteria", type: "Cause" },
        { id: 105, title: "Genetics", type: "Cause" },
        { id: 109, title: "Smoking", type: "Cause" },
        { id: 108, title: "Carcinogens", type: "Cause" },

        // Prevention & Lifestyle
        { id: 201, title: "Vaccination", type: "Prevention" },
        { id: 202, title: "Hygiene", type: "Prevention" },
        { id: 205, title: "Exercise", type: "Prevention" },
        { id: 106, title: "Diet", type: "Prevention" },

        // Treatments (More specific drugs)
        { id: 301, title: "Oseltamivir", type: "Treatment" },
        { id: 302, title: "Paxlovid", type: "Treatment" },
        { id: 303, title: "Lisinopril", type: "Treatment" },
        { id: 304, title: "Metformin", type: "Treatment" },
        { id: 305, title: "Methotrexate", type: "Treatment" },
        { id: 306, title: "Sertraline", type: "Treatment" },
        { id: 309, title: "Chemotherapy", type: "Treatment" },
        { id: 310, title: "Radiation Therapy", type: "Treatment" },
        { id: 307, title: "Psychotherapy", type: "Treatment" },
        { id: 308, title: "Insulin Therapy", type: "Treatment" },
        
        // Anatomy
        { id: 401, title: "Respiratory System", type: "Anatomy" },
        { id: 402, title: "Immune System", type: "Anatomy" },
        { id: 404, title: "Cardiovascular System", type: "Anatomy" },
        { id: 405, title: "Endocrine System", type: "Anatomy" },
        { id: 406, title: "Nervous System", type: "Anatomy" },
        { id: 411, title: "Musculoskeletal System", type: "Anatomy" }
    ];

    const nodes = new vis.DataSet([]);
    const edges = new vis.DataSet([]);

    const groups = {
        Disease: { color: { background: '#d9534f', border: '#d43f3a' }, font: { color: '#fff'} },
        Cause: { color: { background: '#f0ad4e', border: '#eea236' }, font: { color: '#fff'} },
        Prevention: { color: { background: '#5cb85c', border: '#4cae4c' }, font: { color: '#fff'} },
        Treatment: { color: { background: '#5bc0de', border: '#46b8da' }, font: { color: '#fff'} },
        Anatomy: { color: { background: '#9d5ac6', border: '#8b48b8' }, font: { color: '#fff'} }
    };

    const allNodes = new Map();
    items.forEach(item => {
        allNodes.set(item.title, {
            id: item.id,
            label: item.title,
            group: item.type,
            title: `<b>${item.title}</b><br>Type: ${item.type}`,
            description: item.description || "No description available.",
            tags: item.tags || []
        });
    });

    items.forEach(item => {
        if (!item.tags) return;
        item.tags.forEach(tag => {
            if (allNodes.has(tag)) {
                edges.add({ from: item.id, to: allNodes.get(tag).id });
            }
        });
    });
    
    nodes.add(Array.from(allNodes.values()));

    const container = document.getElementById("connections-graph");
    const data = { nodes: nodes, edges: edges };
    
    const options = {
      nodes: {
        shape: 'dot',
        font: { size: 16, color: '#ffffff' },
        borderWidth: 2,
        scaling: {
            min: 20,
            max: 50,
            label: {
                enabled: true,
                min: 14,
                max: 30
            }
        }
      },
      edges: {
        width: 1.5,
        color: {
            color: '#848484',
            highlight: '#a2a2a2'
        },
        smooth: {
            type: 'continuous'
        }
      },
      physics: {
        enabled: true,
        solver: 'forceAtlas2Based',
        forceAtlas2Based: {
          gravitationalConstant: -100,
          centralGravity: 0.01,
          springLength: 150,
          springConstant: 0.08
        }
      },
      interaction: {
        hover: true,
        tooltipDelay: 200,
        navigationButtons: true,
        keyboard: true
      },
      groups: groups
    };

    const network = new vis.Network(container, data, options);

    // --- Controls & UI Logic ---
    const toggleButton = document.getElementById("toggle-physics-button");
    toggleButton.addEventListener("click", () => network.setOptions({ physics: { enabled: !network.getOptions().physics.enabled }}));

    const searchBox = document.getElementById("search-box");
    searchBox.addEventListener('keyup', (e) => {
        if (e.key === 'Enter') {
            const nodeId = Array.from(allNodes.values()).find(n => n.label.toLowerCase() === e.target.value.toLowerCase())?.id;
            if(nodeId) {
                network.focus(nodeId, { scale: 1.2, animation: true });
                network.selectNodes([nodeId]);
            }
        }
    });

    const infoPanel = document.getElementById('info-panel');
    network.on("click", function(params) {
        if (params.nodes.length > 0) {
            const nodeId = params.nodes[0];
            const nodeData = allNodes.get(nodes.get(nodeId).label);
            
            document.getElementById('info-title').innerText = nodeData.label;
            document.getElementById('info-type').innerText = `Type: ${nodeData.group}`;
            document.getElementById('info-description').innerText = nodeData.description;
            document.getElementById('info-link').href = `https://en.wikipedia.org/wiki/${encodeURIComponent(nodeData.label)}`;
            infoPanel.classList.add('visible');
        } else {
            infoPanel.classList.remove('visible');
        }
    });
    
    document.getElementById('close-panel').addEventListener('click', () => infoPanel.classList.remove('visible'));

    // --- NextMind Integration ---
    const nextMindStatusElement = document.getElementById("nextmind-status");
    NextMind.start({
      onConnected: () => {
        nextMindStatusElement.textContent = "NextMind: Connected";
        NextMind.on('input', (event) => {
          if (event.action === 'button') {
            toggleButton.click();
          }
        });
      },
      onDisconnected: () => nextMindStatusElement.textContent = "NextMind: Disconnected"
    });
  });
</script>

</body>
</html>
